<?xml version="1.0" encoding="UTF-8"?>

<?if $(var.Platform) = x64 ?>
<?define bitness = "(64 bit)" ?>
<?define Win64 = "yes" ?>
<?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
<?else ?>
<?define bitness = "(32 bit)" ?>
<?define Win64 = "no" ?>
<?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
<?endif ?>

<?define ProductVersion = "1.6"?>
<?define ProductUpgradeCode = "93CA96F0-E984-4546-8D18-5D509BAE42BE"?>
<?define CompanyName = "dijital.ca"?>
<?define AppName = "geotools"?>
<?define AppExecutable = "geotools.bat"?>
<?define OptDir = "C:\dev\gisinternals"?>
<?define OSGeoDir = "C:\dev\OSGeo4W64"?>
<?define GdalLib = "gdal300"?>
<?define BuildType = "Release"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <Product Id="C5EA56EA-229E-4B71-B1D3-CA3DDE6218D3" Name="$(var.AppName)"
            Language="1033" Version="$(var.ProductVersion)"
            Manufacturer="$(var.CompanyName)" UpgradeCode="$(var.ProductUpgradeCode)">

    <Package InstallerVersion="301" Compressed="yes" InstallScope="perMachine" />

    <Media Id="1" Cabinet="cab1.cab" EmbedCab="yes"/>

    <MajorUpgrade DowngradeErrorMessage="A newer version of $(var.AppName) is already installed." />

    <Feature Id="ProductFeature" Title="$(var.AppName) Setup" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="ProgramMenuDir" />
    </Feature>
    
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">

      <Directory Id="$(var.PlatformProgramFilesFolder)">
        <Directory Id="INSTALLFOLDER" Name="$(var.CompanyName)">
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ApplicationProgramsFolder" Name="$(var.CompanyName)">
          <Component Win64="$(var.Win64)" Id="ProgramMenuDir" Guid="EAF5553D-04B0-4D80-9ACB-00E857660283">
            <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
            <RegistryValue Root="HKCU" Key="Software\$(var.CompanyName)\$(var.AppName)"
                           Type="integer" Value="1" Name="installed" KeyPath="yes" />
            <Shortcut Id="UninstallProduct"
              Name="Uninstall $(var.AppName)"
              Target="[SystemFolder]msiexec.exe"
              Arguments="/x [ProductCode]"
              Description="Uninstalls $(var.AppName)" />
          </Component>
        </Directory>
      </Directory>
    </Directory>

  </Fragment>

  <Fragment>
    
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Win64="$(var.Win64)" Id="GeoToolsBat" Guid="08EEA592-0D5E-4878-9976-D6EA61AC8F8D">
        <File Source="..\..\scripts\geotools.bat" />
        <Shortcut Id="StartMenuShortcut" Directory="ApplicationProgramsFolder"
                  Name="$(var.AppName)" WorkingDirectory="INSTALLFOLDER" Advertise="yes" />
      </Component>
      <Component Win64="$(var.Win64)" Id="GeoPcLib" Guid="D12ED595-7BC8-4F7A-B568-78D1C213C14A">
        <File Source="..\..\build\bin\$(var.BuildType)\geopc.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="GeoAnnLib" Guid="4FA13ADA-251B-4345-94A4-6A6CBA160E81">
        <File Source="..\..\build\bin\$(var.BuildType)\geoann.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="GeoUtilLib" Guid="E448D1CC-6AD5-47EB-8D84-2D2597FE2B0E">
        <File Source="..\..\build\bin\$(var.BuildType)\geoutil.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="GeoGridLib" Guid="5E98213D-58F8-4EB2-A8E1-171649FA860A">
        <File Source="..\..\build\bin\$(var.BuildType)\geogrid.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="GeoDbLib" Guid="E7F8070B-FBFF-4017-9231-31A856928A01">
        <File Source="..\..\build\bin\$(var.BuildType)\geodb.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="FitpackLib" Guid="4FA13ADA-251B-4345-94A4-6A6CBA160E84">
        <File Source="..\..\build\bin\$(var.BuildType)\fitpack_mod.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="ProductComponent" Guid="0AFB8DFB-CB83-4C31-AA6B-42032B5EEA96">
        <File Source="..\..\build\bin\$(var.BuildType)\pc2grid.exe">
          <!--
          <Shortcut Id="StartMenuShortcut1" Directory="ApplicationProgramsFolder"
                    Name="$(var.AppName)" WorkingDirectory="INSTALLFOLDER" Advertise="yes" />
                    -->
        </File>
        <File Source="..\..\build\bin\$(var.BuildType)\pcnorm.exe">
          <!--
          <Shortcut Id="StartMenuShortcut2" Directory="ApplicationProgramsFolder"
                    Name="$(var.AppName)" WorkingDirectory="INSTALLFOLDER" Advertise="yes" />
                    -->
        </File>
        <File Source="..\..\build\bin\$(var.BuildType)\voidfill.exe">
          <!--
          <Shortcut Id="StartMenuShortcut3" Directory="ApplicationProgramsFolder"
                    Name="$(var.AppName)" WorkingDirectory="INSTALLFOLDER" Advertise="yes" />
                    -->
        </File>
      </Component>

      <Component Win64="$(var.Win64)" Id="DepHDF5" Guid="AB12228C-D4D1-47A8-90D5-61BC7400F7F6">
        <File Source="$(var.OptDir)\bin\hdf5.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepIconv" Guid="40B36F3D-4C04-4054-9CC9-E2CF159D42D7">
        <File Source="$(var.OptDir)\bin\iconv.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepHDF5HL" Guid="7737DFBA-565A-4EC4-9795-A6379C37B750">
        <File Source="$(var.OptDir)\bin\hdf5_hl.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep4" Guid="0E6CE6B5-7B1D-498A-8F94-118AD1B3B95F">
        <File Source="$(var.OptDir)\bin\expat.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep5" Guid="A954573A-4205-4BD8-9FF0-F3816BD8008C">
        <File Source="$(var.OptDir)\bin\freexl.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep6" Guid="17BA70B7-4A5B-4272-A81A-1629ECD9C510">
        <File Source="$(var.OptDir)\bin\$(var.GdalLib).dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepGdal111" Guid="762158C5-515A-4CC8-8601-46844D1F5D89">
        <File Source="$(var.OSGeoDir)\bin\gdal111.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepTiff" Guid="C7D2183B-0A81-45D1-B93D-46B10A029A4A">
        <File Source="$(var.OSGeoDir)\bin\libtiff.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepGeoTiff" Guid="22E3D78C-3801-41FD-8702-9467A19DF76E">
        <File Source="$(var.OSGeoDir)\bin\geotiff.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepJpeg" Guid="5CA3C8AD-2BAB-4ED4-94D7-FDAE5EB1A58C">
        <File Source="$(var.OSGeoDir)\bin\jpeg.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepJpeg12" Guid="75DE938A-B3F8-4B02-B455-7EA0A8F3F490">
        <File Source="$(var.OSGeoDir)\bin\jpeg12.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepLzma" Guid="89FAC76F-394C-48C6-9C52-98FF7036D430">
        <File Source="$(var.OSGeoDir)\bin\liblzma.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepOgdi" Guid="3640B65C-BFE5-42AC-A2F6-4A1C8701C6FE">
        <File Source="$(var.OSGeoDir)\bin\ogdi.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep7" Guid="DF004BFA-84F1-474D-897B-12B69EB1AD4D">
        <File Source="$(var.OptDir)\bin\geos.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep8" Guid="6BAB57A6-552E-4023-9166-A456D0BCBF1A">
        <File Source="$(var.OptDir)\bin\geos_c.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep10" Guid="ECDF7FED-8AE5-41F1-A7BC-08F3FF45081D">
        <File Source="$(var.OptDir)\bin\libcurl.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep12" Guid="527C2F03-6AB5-4376-BA4C-FE8EC3898FA5">
        <File Source="$(var.OptDir)\bin\libmysql.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep13" Guid="232DCE5A-E4EA-4B5E-A625-9CECF718B9CA">
        <File Source="$(var.OptDir)\bin\libpq.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep14" Guid="7C3D6590-74C8-488A-A340-19EAA8BB4432">
        <File Source="$(var.OptDir)\bin\libxml2.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepLibLas" Guid="DD43F8A7-0673-423D-8C0E-8CEDD4B988A8">
        <File Source="$(var.OSGeoDir)\bin\liblas.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepLibLasC" Guid="7CD4A8FF-8E4E-46D4-8CA7-31EF1D0A138F">
        <File Source="$(var.OSGeoDir)\bin\liblas_c.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepLasZip" Guid="2A997A24-2543-470F-8F40-2D94661BA609">
        <File Source="$(var.OSGeoDir)\bin\laszip.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepLasZipApi3" Guid="30E4D5E0-B768-4A0B-B42F-CF02892ACFB8">
        <File Source="$(var.OSGeoDir)\bin\laszip_api3.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepLasZip3" Guid="44757B00-64D4-4635-AC9F-C63B29298C71">
        <File Source="$(var.OSGeoDir)\bin\laszip3.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep15" Guid="5EC46216-751B-43B7-A863-F5612E0CCDCA">
        <File Source="$(var.OptDir)\bin\openjp2.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep16" Guid="FDD5CBCD-C9EF-423D-827F-A9892954D6DF">
        <File Source="$(var.OptDir)\bin\proj_6_1.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep160" Guid="9079586E-C200-4CAA-AE31-DCFF3E15213B">
        <File Source="$(var.OptDir)\bin\proj.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep17" Guid="5644074F-BA29-4E42-B9FC-4B4E0E81BB72">
        <File Source="$(var.OptDir)\bin\spatialite.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep18" Guid="17EF806E-7DF0-4BA9-8B67-665944E1DC4B">
        <File Source="$(var.OptDir)\bin\sqlite3.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep31" Guid="17EF806E-7DF0-4BA9-8B67-665944E1DC4C">
        <File Source="$(var.OptDir)\bin\libeay32.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep32" Guid="17EF806E-7DF0-4BA9-8B67-665944E1DC4D">
        <File Source="$(var.OptDir)\bin\ssleay32.dll" />
      </Component>
      <!-- Interferes with system zlib?
      <Component Win64="$(var.Win64)" Id="DepZlib" Guid="8522723B-03CE-46C9-A27E-08ACF5061405">
        <File Source="$(var.OptDir)\bin\zlib1.dll" />
      </Component>
      -->
      <Component Win64="$(var.Win64)" Id="Dep35" Guid="17EF806E-7DF0-4BA9-8B67-665944E1DC50">
        <File Source="$(var.OptDir)\bin\szip.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep36" Guid="17EF806E-7DF0-4BA9-8B67-665944E1DC51">
        <File Source="$(var.OptDir)\bin\netcdf.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepXerces32" Guid="22CA6EC3-7B59-4E4B-BC21-A06172790CAD">
        <File Source="$(var.OptDir)\bin\xerces-c_3_2.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepXerces31" Guid="8965E86D-3CDC-4C3B-858E-3A62E20AF791">
        <File Source="$(var.OSGeoDir)\bin\xerces-c_3_1.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="DepPng16" Guid="0BA9FAA2-546D-4D71-B200-3F1C6F6FB155">
        <File Source="$(var.OSGeoDir)\bin\libpng16.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep21" Guid="32FCAD4F-DA15-4BDA-BF9E-90012CB7A8E8">
        <File Source="$(var.OptDir)\bin\vcruntime140.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep21_1" Guid="6DE36302-8E53-42C3-866A-46944E02409B">
        <File Source="$(var.OptDir)\bin\vcruntime140_1.dll" />
      </Component>
      <Component Win64="$(var.Win64)" Id="Dep29" Guid="32FCAD4F-DA15-4BDA-BF9E-90012CB7A8E9">
        <File Source="$(var.OptDir)\bin\msvcp140.dll" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>
